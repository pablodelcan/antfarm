<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Antfarm</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=Inter:wght@300;400;500;600;700;800;900&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000; color: #1a1a1a;
    font-family: 'Inter', -apple-system, sans-serif;
    height: 100vh; overflow: hidden; -webkit-font-smoothing: antialiased;
  }

  /* ── Intro Screen ── */
  .intro {
    position: fixed; inset: 0; background: #e8e5e0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 100; transition: opacity 0.8s ease;
  }
  .intro.hide { opacity: 0; pointer-events: none; }
  .intro h1 {
    font-family: 'EB Garamond', serif; font-size: clamp(2.5rem, 5vw, 4.5rem);
    font-weight: 400; font-style: italic; margin-bottom: 12px; letter-spacing: -0.01em;
  }
  .intro .sub { color: #999; font-size: 0.82rem; letter-spacing: 0.08em; margin-bottom: 12px; }
  .intro .sub2 { color: #bbb; font-size: 0.7rem; letter-spacing: 0.06em; margin-bottom: 48px; }
  .intro button {
    background: none; border: 1px solid #ccc; color: #1a1a1a;
    font-family: 'Inter', sans-serif; font-size: 0.78rem; letter-spacing: 0.14em;
    text-transform: uppercase; padding: 14px 44px; cursor: pointer; transition: all 0.3s;
  }
  .intro button:hover { border-color: #1a1a1a; background: #1a1a1a; color: #fff; }

  /* ── App Layout ── */
  .app {
    display: none; width: 100vw; height: 100vh;
    position: relative; overflow: hidden;
    flex-direction: column;
  }

  /* ── Top Bar — solid black strip ── */
  .bar-top {
    height: 28px; min-height: 28px;
    background: #000;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 16px;
    z-index: 20; position: relative;
  }
  .bar-top .title {
    font-family: 'EB Garamond', serif; font-size: 0.88rem; font-weight: 400;
    font-style: italic; color: #ccc; line-height: 1; white-space: nowrap;
  }
  .bar-top .stats {
    display: flex; gap: 14px; font-size: 0.65rem; color: rgba(255,255,255,0.7);
    align-items: center;
  }
  .bar-top .stat-group {
    display: flex; align-items: center; gap: 3px; white-space: nowrap;
  }
  .bar-top .stat-label {
    font-weight: 400; font-size: 0.6rem; color: rgba(255,255,255,0.4);
  }
  .bar-top .stat-val {
    font-weight: 600; font-size: 0.65rem; font-variant-numeric: tabular-nums;
    color: rgba(255,255,255,0.85);
  }
  .bar-top .right-group {
    display: flex; align-items: center; gap: 12px;
  }
  .bar-top .help-btn {
    cursor: pointer; color: rgba(255,255,255,0.35); font-size: 0.65rem;
    font-weight: 700; width: 16px; height: 16px; display: flex;
    align-items: center; justify-content: center;
    border: 1px solid rgba(255,255,255,0.2); border-radius: 50%;
    transition: all 0.2s;
  }
  .bar-top .help-btn:hover { color: #fff; border-color: rgba(255,255,255,0.6); }
  .bar-top .ai-link {
    display: flex; align-items: center; gap: 5px;
    cursor: pointer; pointer-events: auto;
    color: rgba(255,255,255,0.5); font-size: 0.6rem; font-weight: 600;
    transition: color 0.2s;
  }
  .bar-top .ai-link:hover { color: rgba(255,255,255,0.9); }
  .bar-top .ai-dot {
    width: 4px; height: 4px; border-radius: 50%;
    background: rgba(255,255,255,0.5);
  }

  /* ── Canvas Area — fills remaining space ── */
  .canvas-wrap {
    flex: 1; position: relative; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    background: #000;
  }
  .canvas-wrap canvas {
    display: block; cursor: crosshair;
  }

  /* ── Bottom Bar — solid black strip ── */
  .bar-bottom {
    height: 24px; min-height: 24px;
    background: #000;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 16px;
    z-index: 20; position: relative;
  }
  .bar-bottom .intel-left {
    display: flex; align-items: center; gap: 8px;
    font-size: 0.58rem; color: rgba(255,255,255,0.45);
  }
  .bar-bottom .intel-focus {
    font-family: 'EB Garamond', serif; font-style: italic;
    font-size: 0.72rem; color: rgba(255,255,255,0.65);
  }
  .bar-bottom .intel-roles {
    color: rgba(255,255,255,0.35); font-size: 0.56rem;
  }
  .bar-bottom .intel-right {
    display: flex; align-items: center; gap: 8px;
    font-size: 0.56rem; color: rgba(255,255,255,0.3);
  }
  .bar-bottom .live-dot {
    width: 5px; height: 5px; border-radius: 50%; background: #e74c3c;
    animation: livePulse 2s ease-in-out infinite;
  }
  @keyframes livePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* ── AI Modal ── */
  .ai-modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.7);
    display: none; align-items: center; justify-content: center;
    z-index: 200;
  }
  .ai-modal-overlay.show { display: flex; }
  .ai-modal {
    background: #111; border: 1px solid #333;
    max-width: 480px; width: 90%; padding: 28px 32px;
    color: #ddd; position: relative;
  }
  .ai-modal h2 {
    font-family: 'EB Garamond', serif; font-size: 1.4rem; font-weight: 400;
    font-style: italic; color: #fff; margin-bottom: 16px;
  }
  .ai-modal p {
    font-size: 0.75rem; line-height: 1.7; color: rgba(255,255,255,0.7);
    margin-bottom: 12px;
  }
  .ai-modal .ai-stat {
    display: flex; justify-content: space-between;
    font-size: 0.68rem; color: rgba(255,255,255,0.5);
    padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .ai-modal .ai-stat .val { color: rgba(255,255,255,0.85); font-weight: 600; }
  .ai-modal .close-btn {
    position: absolute; top: 12px; right: 16px;
    background: none; border: none; color: rgba(255,255,255,0.4);
    font-size: 1.2rem; cursor: pointer; padding: 4px 8px;
  }
  .ai-modal .close-btn:hover { color: #fff; }
  .ai-modal ul {
    margin: 8px 0 12px 18px; font-size: 0.72rem; line-height: 1.8;
    color: rgba(255,255,255,0.6);
  }
  .ai-modal ul li strong { color: rgba(255,255,255,0.85); }
  .ai-modal h3 {
    font-size: 0.8rem; font-weight: 600; color: rgba(255,255,255,0.8);
    margin: 14px 0 4px; letter-spacing: 0.03em;
  }

  /* ── Tooltip ── */
  .ant-tooltip {
    position: fixed; pointer-events: none;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px;
    font-size: 0.68rem; line-height: 1.5; color: rgba(255,255,255,0.7);
    z-index: 50; opacity: 0; transition: opacity 0.15s ease; max-width: 220px; white-space: nowrap;
    border-radius: 8px;
  }
  .ant-tooltip.show { opacity: 1; }
  .ant-tooltip .tt-name { color: #fff; font-weight: 500; margin-bottom: 2px; font-size: 0.72rem; }
  .ant-tooltip .tt-row { display: flex; justify-content: space-between; gap: 12px; }
  .ant-tooltip .tt-val { color: #fff; font-weight: 500; }

  /* ── Toast ── */
  .toast {
    position: fixed; bottom: 48px; left: 50%; transform: translateX(-50%) translateY(8px);
    background: rgba(255,255,255,0.95); color: #1a1a1a; padding: 8px 20px; font-size: 0.72rem;
    opacity: 0; transition: all 0.25s ease; z-index: 90; pointer-events: none;
    border-radius: 6px;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ── Hidden Admin Panel (j+k+l) ── */
  .admin-panel {
    position: fixed; bottom: 44px; left: 50%; transform: translateX(-50%);
    background: rgba(20,20,20,0.95); backdrop-filter: blur(10px);
    border: 1px solid #333; padding: 12px 20px;
    display: none; align-items: center; gap: 16px;
    z-index: 80; border-radius: 6px;
  }
  .admin-panel.show { display: flex; }
  .admin-panel button {
    background: #333; color: #ddd; border: 1px solid #555;
    font-family: 'Inter', sans-serif; font-size: 0.65rem;
    padding: 6px 14px; cursor: pointer; transition: all 0.2s;
    letter-spacing: 0.04em; text-transform: uppercase;
  }
  .admin-panel button:hover { background: #555; color: #fff; }

  /* ── Theme toggle button ── */
  .bar-top .theme-btn {
    cursor: pointer; color: rgba(255,255,255,0.35); font-size: 0.72rem;
    width: 16px; height: 16px; display: flex;
    align-items: center; justify-content: center;
    transition: all 0.2s; background: none; border: none;
  }
  .bar-top .theme-btn:hover { color: #fff; }

  /* ── Light mode ── */
  body.light .bar-top { background: #f5f2ee; }
  body.light .bar-top .title { color: #333; }
  body.light .bar-top .stat-label { color: rgba(0,0,0,0.4); }
  body.light .bar-top .stat-val { color: rgba(0,0,0,0.8); }
  body.light .bar-top .help-btn { color: rgba(0,0,0,0.35); border-color: rgba(0,0,0,0.2); }
  body.light .bar-top .help-btn:hover { color: #000; border-color: rgba(0,0,0,0.6); }
  body.light .bar-top .theme-btn { color: rgba(0,0,0,0.35); }
  body.light .bar-top .theme-btn:hover { color: #000; }
  body.light .bar-top .ai-link { color: rgba(0,0,0,0.5); }
  body.light .bar-top .ai-link:hover { color: rgba(0,0,0,0.9); }
  body.light .bar-top .ai-dot { background: rgba(0,0,0,0.5); }
  body.light .canvas-wrap { background: #e8e5e0; }
  body.light .bar-bottom { background: #f5f2ee; }
  body.light .bar-bottom .intel-focus { color: rgba(0,0,0,0.65); }
  body.light .bar-bottom .intel-roles { color: rgba(0,0,0,0.35); }
  body.light .bar-bottom .intel-right { color: rgba(0,0,0,0.3); }
  body.light .ant-tooltip { background: rgba(255,255,255,0.92); border-color: rgba(0,0,0,0.1); color: rgba(0,0,0,0.7); }
  body.light .ant-tooltip .tt-name { color: #000; }
  body.light .ant-tooltip .tt-val { color: #000; }
  body.light .toast { background: rgba(0,0,0,0.85); color: #fff; }
  body.light .admin-panel { background: rgba(240,237,232,0.95); border-color: #ccc; }
  body.light .admin-panel button { background: #ddd; color: #333; border-color: #bbb; }
  body.light .admin-panel button:hover { background: #ccc; color: #000; }
  body.light .ai-modal { background: #f5f2ee; border-color: #ccc; color: #333; }
  body.light .ai-modal h2 { color: #1a1a1a; }
  body.light .ai-modal p { color: rgba(0,0,0,0.65); }
  body.light .ai-modal .ai-stat { color: rgba(0,0,0,0.5); border-color: rgba(0,0,0,0.08); }
  body.light .ai-modal .ai-stat .val { color: rgba(0,0,0,0.85); }
  body.light .ai-modal .close-btn { color: rgba(0,0,0,0.4); }
  body.light .ai-modal .close-btn:hover { color: #000; }
  body.light .ai-modal h3 { color: rgba(0,0,0,0.8); }
  body.light .ai-modal ul { color: rgba(0,0,0,0.6); }
  body.light .ai-modal ul li strong { color: rgba(0,0,0,0.85); }
  body.light .ai-modal-overlay { background: rgba(0,0,0,0.3); }

  /* ── Hidden data elements ── */
  .hidden-data { display: none; }
</style>
</head>
<body>

<!-- Intro Screen -->
<div class="intro">
  <h1>Antfarm</h1>
  <div class="sub">A living colony powered by Claude AI</div>
  <div class="sub2">v24</div>
  <button onclick="begin()">Enter</button>
</div>

<!-- Main App -->
<div class="app" id="app">
  <!-- Top black bar -->
  <div class="bar-top">
    <div class="title">Antfarm</div>
    <div class="stats">
      <div class="stat-group"><span class="stat-label">Pop</span><span class="stat-val" id="sAnts">0</span></div>
      <div class="stat-group"><span class="stat-label">Brood</span><span class="stat-val" id="sBrood">0</span></div>
      <div class="stat-group"><span class="stat-label">Dug</span><span class="stat-val" id="sTunnel">0%</span></div>
      <div class="stat-group"><span class="stat-label">Chmbrs</span><span class="stat-val" id="sChambers">0</span></div>
      <div class="stat-group"><span class="stat-label">Food</span><span class="stat-val" id="sStored">0</span></div>
      <div class="stat-group"><span class="stat-label">Day</span><span class="stat-val" id="sDay">1</span></div>
    </div>
    <div class="right-group">
      <div class="ai-link" id="aiLink" onclick="showAiModal()">
        <span class="ai-dot"></span>
        <span>Claude AI</span>
      </div>
      <button class="theme-btn" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">&#9788;</button>
      <div class="help-btn" onclick="showHelpModal()">?</div>
    </div>
  </div>

  <!-- Canvas fills remaining space -->
  <div class="canvas-wrap" id="wrap">
    <canvas id="c"></canvas>
  </div>

  <!-- Bottom black bar -->
  <div class="bar-bottom">
    <div class="intel-left">
      <span class="intel-focus" id="intelFocusDisplay">Observing colony</span>
      <span class="intel-roles" id="intelRolesDisplay"></span>
    </div>
    <div class="intel-right">
      <span id="intelInsightDisplay"></span>
      <span class="live-dot"></span>
      <span>LIVE</span>
      <span>Day <span id="sDay2">1</span></span>
    </div>
  </div>
</div>

<!-- Hidden data trackers -->
<div class="hidden-data">
  <span id="intelFocus"></span>
  <span id="intelRoles"></span>
  <span id="intelTokens"></span>
  <span id="intelInsight"></span>
  <span id="aiNarration"></span>
</div>

<!-- Tooltip -->
<div class="ant-tooltip" id="tooltip">
  <div class="tt-name" id="ttName"></div>
  <div class="tt-row"><span>State</span><span class="tt-val" id="ttState"></span></div>
  <div class="tt-row"><span>Energy</span><span class="tt-val" id="ttEnergy"></span></div>
  <div class="tt-row"><span>Role</span><span class="tt-val" id="ttRole"></span></div>
  <div class="tt-row"><span>Thought</span><span class="tt-val" id="ttThought"></span></div>
</div>

<div class="toast" id="toast"></div>

<!-- AI Info Modal -->
<div class="ai-modal-overlay" id="aiModal" onclick="hideAiModal(event)">
  <div class="ai-modal" onclick="event.stopPropagation()">
    <button class="close-btn" onclick="hideAiModal()">&times;</button>
    <h2>How Claude AI Powers This Colony</h2>
    <p>
      This ant colony is guided by <strong>Claude</strong> (Anthropic's AI). Every few minutes, Claude analyzes the colony's state &mdash; population, tunnel depth, food stores, brood count &mdash; and issues strategic directives that shape the ants' behavior.
    </p>
    <p>
      Claude decides the colony's <strong>focus</strong> (dig deeper, forage for food, tend brood, explore), adjusts <strong>role assignments</strong> (shifting idle ants to diggers or nurses), and tunes parameters like exploration range and rest thresholds.
    </p>
    <p>
      A daily review provides longer-term evolutionary tuning &mdash; adjusting the colony's DNA-like parameters based on overall health trends.
    </p>
    <div style="margin-top:16px">
      <div class="ai-stat"><span>Current focus</span><span class="val" id="aiModalFocus">Observing</span></div>
      <div class="ai-stat"><span>Role shifts</span><span class="val" id="aiModalRoles">&mdash;</span></div>
      <div class="ai-stat"><span>Token usage</span><span class="val" id="aiModalTokens">&mdash;</span></div>
      <div class="ai-stat"><span>AI thoughts</span><span class="val" id="aiModalCalls">&mdash;</span></div>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div class="ai-modal-overlay" id="helpModal" onclick="hideHelpModal(event)">
  <div class="ai-modal" onclick="event.stopPropagation()" style="max-width:520px">
    <button class="close-btn" onclick="hideHelpModal()">&times;</button>
    <h2>How the Colony Works</h2>

    <h3>Colony Lifecycle</h3>
    <p>A queen and 8 workers start on the surface. Workers dig a main shaft, branch tunnels, and carve chambers for food storage, brood rearing, and rest. The queen lays eggs that hatch into larvae, get fed by nurses, pupate, and emerge as new workers.</p>

    <h3>Ant Roles</h3>
    <ul>
      <li><strong>Diggers</strong> &mdash; excavate tunnels and chambers, haul sand to the surface</li>
      <li><strong>Foragers</strong> &mdash; search for food on the surface and bring it underground</li>
      <li><strong>Nurses</strong> &mdash; feed larvae from food stores so they can grow</li>
      <li><strong>Explorers</strong> &mdash; scout new tunnel paths and dig sites</li>
    </ul>

    <h3>Survival</h3>
    <p>Ants burn energy constantly. Digging is especially draining. When hungry, they seek food stores or surface food to eat. If they can't find food, they starve and die. Keep the colony fed by dropping food (admin panel: press <strong>J+K+L</strong>).</p>

    <h3>Tunnel Architecture</h3>
    <p>Tunnels are narrow (1&ndash;2 cells wide), mimicking real ant tunnels. Chambers are wider, flat spaces for storing food and rearing brood. The entrance has a crater-shaped mound with the hole kept clear at the center.</p>

    <h3>AI Guidance</h3>
    <p>Claude AI analyzes the colony every few minutes, deciding focus (dig, forage, nurse, explore) and shifting worker roles. Click <strong>Claude AI</strong> in the top bar to see current directives.</p>
  </div>
</div>

<!-- Hidden Admin Panel -->
<div class="admin-panel" id="adminPanel">
  <button onclick="adminAction('addAnts')">+5 Ants</button>
  <button onclick="adminAction('dropFood')">Drop Food</button>
  <button onclick="if(confirm('Reset?')) restartColony()" style="background:#8b0000;color:#fff">Reset</button>
</div>

<!-- Scripts -->
<script src="/js/constants.js?v=27"></script>
<script src="/js/terrain.js?v=27"></script>
<script src="/js/pheromones.js?v=27"></script>
<script src="/js/ant.js?v=27"></script>
<script src="/js/behavior.js?v=27"></script>
<script src="/js/colony.js?v=27"></script>
<script src="/js/renderer.js?v=27"></script>
<script src="/js/network.js?v=27"></script>
<script src="/js/main.js?v=27"></script>

</body>
</html>
